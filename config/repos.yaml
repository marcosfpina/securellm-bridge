# config/repos.yaml - Phantom Knowledge Base Configuration
#
# Define repositórios, hooks e configurações de relatório.
# Estrutura "verbosa e elegante" para controle total.

global:
  workspace_root: "."
  reports_dir: "./data/reports"
  artifacts_dir: "./data/analyzed"
  max_concurrency: 4

  # Padrões globais de exclusão
  exclude:
    - ".git"
    - ".venv"
    - "__pycache__"
    - "node_modules"
    - "dist"
    - "build"

repos:
  - name: phantom-core
    path: "."
    priority: critical
    description: "Core do framework Phantom e CLI"

    # Contexto para o analisador (RAG/LLM)
    context: |
      Este é o repositório principal. Contém a lógica de extração,
      o motor RAG (LangChain) e as integrações com GCP.
      Foco em performance e segurança.

    # Hooks: Comandos executados durante o ciclo de vida
    hooks:
      pre_analyze:
        - description: "Validar estrutura do projeto"
          command: "poetry check"
        - description: "Limpar artefatos antigos"
          command: "rm -rf data/analyzed/phantom-core"

      post_analyze:
        - description: "Rodar testes unitários rápidos"
          command: "poetry run pytest -v"
        - description: "Gerar relatório executivo"
          command: "phantom knowledge summarize phantom-core"

    options:
      deep_analysis: true
      extract_ast: true
      security_scan: true

  - name: phoenix-infra
    path: "./nix"
    priority: high
    description: "Configurações NixOS e Infraestrutura"

    context: |
      Configurações de infraestrutura NixOS, definições de flakes,
      e scripts de deployment. Foco em reprodutibilidade hermética.

    hooks:
      pre_analyze:
        - description: "Validar integridade do flake NixOS"
          command: "nix flake check"
          allow_failure: true
          timeout: 300
          retry: false

      post_analyze:
        - description: "Verificar sintaxe de arquivos Nix"
          command: "find . -name '*.nix' -type f -exec nix-instantiate --parse {} \\; > /dev/null"
          allow_failure: true
        - description: "Gerar relatório de configuração"
          command: "phantom knowledge summarize phoenix-infra"
          allow_failure: true

    options:
      languages: ["nix", "bash"]
      deep_analysis: true
      extract_dependencies: true
