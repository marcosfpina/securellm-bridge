# .gitlab-ci/stages/validate.yml
# Validation stage jobs for GitLab CI/CD

validate:imports:
  stage: validate
  image: python:3.13-slim
  script:
    - apt-get update && apt-get install -y git curl
    - curl -sSL https://install.python-poetry.org | python3 -
    - export PATH="/root/.local/bin:$PATH"
    - poetry install --no-root
    - poetry run python -c "from phantom.core import gcp"
    - poetry run python -c "from phantom.modules import credit_burner"
    - poetry run python -c "import typer; import rich"
  cache:
    paths:
      - .venv/
      - .cache/pip/
  only:
    - main
    - merge_requests

validate:syntax:
  stage: validate
  image: python:3.13-slim
  script:
    - apt-get update && apt-get install -y git
    - curl -sSL https://install.python-poetry.org | python3 -
    - export PATH="/root/.local/bin:$PATH"
    - poetry install --no-root
    - find src/phantom/ -name "*.py" -exec python -m py_compile {} \;
  cache:
    paths:
      - .venv/
      - .cache/pip/
  only:
    - main
    - merge_requests
